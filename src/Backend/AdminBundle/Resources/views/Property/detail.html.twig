{% extends 'BackendAdminBundle::layout.html.twig' %}

{% block breadcrumb %}
    {{ parent() }}
    <li> <a href="{{ path('backend_admin_property_index') }}">{{ 'label_menu.property'|trans  }}</a> </li>
    <li> <a href="{{ path('backend_admin_property_detail', { 'id': entity.id }) }}">{{ 'label_detail'|trans  }}</a> </li>

{% endblock %}

{% block body -%}
    {{ parent() }}


    {% set myLocale = app.request.getLocale() %}


        <div class="header">
            <div class="container">
                <div class="row">
                    <div class="col-md-3">
                        <h3 class="header-title">{{ 'label_property_details'|trans }}</h3>
                    </div>
                    <div class="col-md-7 text-left">
                        <h4>{{ entity }}<span style="font-size:14px;"> {{ entity.complex }}</span> </h4>
                    </div>
                    <div class="col-md-2">
                        {#<button type="submit" class="btn btn-primary">Change Tenant</button>#}
                    </div>
                </div>

                <hr style="border-width: 1px; border-style: dashed; border-color: #93a7b2;"/>

            </div>
        </div>

        <!-- CONTENT -->
        <div class="main-content no-bordertop">
            <div class="container">
                <div class="form-inputs-g">

                    <div class="row color2">
                        <div class="col-md-6">
                            <div class="col-md-3">
                                <p class="txt-blue-bold">{{ 'label_tenant'|trans }}:</p>
                            </div>
                            <div class="col-md-1">

                            </div>
                            <div class="col-md-8">
                                <p>{{ mainContract.user.name }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="col-md-3 text-right">
                                <p class="txt-blue-bold">{{ 'label_owner'|trans }}:</p>
                            </div>
                            <div class="col-md-1">

                            </div>
                            <div class="col-md-8">
                                <p>{{ mainContract.owner is not null ? mainContract.owner.name : '' }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="row color1">
                        <div class="col-md-6">
                            <div class="col-md-4">
                                <p class="txt-blue-bold text-left">{{ 'label_familiy_members'|trans }}: </p>
                            </div>
                            <div class="col-md-8">
                                {%  set strTenants = '' %}
                                {%  set intTenants = 0 %}
                                {% for contract in tenantContracts  %}
                                    {%  set strTenants = strTenants ~ contract.user.name ~ ',' %}
                                    {% set intTenants = intTenants+1 %}
                                {%  endfor %}

                                <p>{{ intTenants }}<br> {{ strTenants }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="col-md-3 text-right">
                                <p class="txt-blue-bold">{{ 'label_address'|trans }}: </p>
                            </div>
                            <div class="col-md-1">

                            </div>
                            <div class="col-md-8">
                                <p>{{ entity.address }}</p>
                            </div>
                        </div>
                    </div>


                    <div class="row color2">
                        <div class="col-md-6">
                            <div class="col-md-3">
                                <p class="txt-blue-bold">{{ 'label_tenant'|trans }} - {{ 'label_email'|trans }}:</p>
                            </div>
                            <div class="col-md-1">

                            </div>
                            <div class="col-md-8">
                                <p>{{ mainContract.user.email }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="col-md-3 text-right">
                                <p class="txt-blue-bold">{{ 'label_owner'|trans }} - {{ 'label_email'|trans }}:</p>
                            </div>
                            <div class="col-md-1">

                            </div>
                            <div class="col-md-8">
                                <p>{{ mainContract.ownerEmail }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="row color1">
                        <div class="col-md-6">
                            <div class="col-md-3">
                                <p class="txt-blue-bold">{{ 'label_tenant'|trans }} - {{ 'label_phone'|trans }}:</p>
                            </div>
                            <div class="col-md-1">

                            </div>
                            <div class="col-md-8">
                                <p>{{ mainContract.user.mobilePhone }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="col-md-3 text-right">
                                <p class="txt-blue-bold">{{ 'label_owner'|trans }} - {{ 'label_phone'|trans }}:</p>
                            </div>
                            <div class="col-md-1">

                            </div>
                            <div class="col-md-8">
                                <p>{{ mainContract.owner is not null ? mainContract.owner.mobilePhone : '' }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="row color2">
                        <div class="col-md-6">
                            <div class="col-md-3">
                                <p class="txt-blue-bold">{{ 'label_emergency_call'|trans }}:</p>
                            </div>
                            <div class="col-md-1">

                            </div>
                            <div class="col-md-8">
                                <p>{{ mainContract.user.emergencyPhoneNumber }}</p>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="col-md-3 text-right">
                                <p class="txt-blue-bold">{{ 'label_emergency_call'|trans }}:</p>
                            </div>
                            <div class="col-md-1">

                            </div>
                            <div class="col-md-8">
                                <p>{{ mainContract.owner is not null ? mainContract.owner.emergencyPhoneNumber : '' }} </p>
                            </div>
                        </div>
                    </div>


                    <hr style="border-width: 1px; border-style: dashed; border-color: #93a7b2;"/>


                    <div class="row color2">
                        <div class="col-md-6">
                            <div class="col-md-5">
                                <p class="txt-blue-bold text-left">{{ 'label_property_agreement'|trans }}:</p>
                            </div>
                            <div class="col-md-7">
                                {{ propertyContract.id }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="col-md-5">
                                <p class="txt-blue-bold text-right">{{ 'label_who_pays_maintenance'|trans }}: </p>
                            </div>
                            <div class="col-md-7 text-right">

                                {{ propertyContract.whoPaysMaintenance == 'owner' ? 'label_owner'|trans : 'label_tenant'|trans }}
                            </div>
                        </div>
                    </div>

                    <div class="row color1">
                        <div class="col-md-6">

                            <div class="col-md-5">
                                <p class="txt-blue-bold">{{ 'label_property_agreement'|trans }} {{ 'label_start'|trans }}: </p>
                            </div>
                            <div class="col-md-7 text-right">
                                {{ propertyContract.startDate|date("m/d/Y") }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="col-md-5">
                                <p class="txt-blue-bold text-right">{{ 'label_maintenance'|trans }} {{ 'label_cost'|trans }}: </p>
                            </div>
                            <div class="col-md-7 text-right">
                                {{ propertyContract.maintenancePrice|number_format(2, '.', '') }} <a href="{{ path('backend_admin_property_update_maintenance', {id: entity.id}) }}"  ><button class="btn_update btn-primary" type="button">{{ 'label_update'|trans }}</button></a>
                            </div>
                        </div>
                    </div>

                    <div class="row color2">
                        <div class="col-md-6">
                            <div class="col-md-5">
                                <p class="txt-blue-bold">{{ 'label_property_agreement'|trans }} {{ 'label_end'|trans }}: </p>
                            </div>
                            <div class="col-md-7 text-right">
                                {{ propertyContract.endDate|date("m/d/Y") }}
                            </div>

                        </div>
                        <div class="col-md-6">
                            <div class="col-md-5">
                                <p class="txt-blue-bold text-right">{{ 'label_property_agreement'|trans }} {{ 'label_expires'|trans }} {{ 'label_in'|trans }} : </p>
                            </div>
                            <div class="col-md-7 text-right">
                                {{ remainingTime }}
                                <br/>
                                <a href="{{ path('backend_admin_property_contract_extend', {id: entity.id}) }}" ><button type="button"  class="btn_update btn-primary">{{ 'label_extend'|trans }} </button></a>&nbsp;&nbsp;<a href="{{ path('backend_admin_property_contract_cancel', {id: entity.id}) }}"  ><button type="submit"  class="btn_cancel btn-primary">{{ 'label_cancel'|trans }}</button></a>
                            </div>
                        </div>
                    </div>
                    <br>

                    <div id="tabs">
                        <ul>
                            <li><a href="#tabs-tickets">{{ 'label_menu.ticket'|trans }}</a></li>
                            <li><a href="#tabs-payments">{{ 'label_menu.payment'|trans }}</a></li>
                            <li><a href="#tabs-booking">{{ 'label_booking'|trans }}</a></li>
                            <li><a href="#tabs-log">{{ 'label_log'|trans }}</a></li>
                        </ul>
                        <div id="tabs-tickets">

                            <!-- widget content -->
                            <div class="widget-body no-padding">

                                <div class="widget-body-toolbar">

                                </div>

                                <table id="ticket_table" class="table table-striped table-hover fulltable">
                                    <tfoot class="dt_tfoot">
                                    <tr>
                                        <th>&nbsp;</th>
                                        <th>{{ 'label_property_contract'|trans }}</th>
                                        <th>{{ 'label_title'|trans }}</th>
                                        <th>&nbsp;</th>
                                        <th>{{ 'label_category'|trans }}</th>
                                        <th>&nbsp;</th>
                                        <th class="pizote-actions">&nbsp;</th>

                                        <th class="pizote-actions">&nbsp;</th>

                                    </tr>
                                    </tfoot>
                                    <thead>
                                    <tr>
                                        {# sorting of properties based on query components #}
                                        <th>ID</th>
                                        <th>{{ 'label_property_contract'|trans }}</th>
                                        <th>{{ 'label_title'|trans }}</th>
                                        <th>{{ 'label_type'|trans }}</th>
                                        <th>{{ 'label_category'|trans }}</th>
                                        <th>{{ 'label_status'|trans }}</th>
                                        <th class="pizote-actions">{{ 'label_time_elapsed'|trans }}</th>

                                        <th class="pizote-actions">{{ 'label_actions'|trans }}</th>
                                    </tr>

                                    </thead>
                                    <tbody></tbody>

                                </table>
                                {# display navigation #}

                            </div>
                            <!-- end widget content -->

                        </div>
                        <div id="tabs-payments">


                            <!-- widget content -->
                            <div class="widget-body no-padding">

                                <div class="widget-body-toolbar">

                                </div>

                                <table id="payment_table" class="table table-striped  table-hover fulltable">
                                    <tfoot class="dt_tfoot">
                                        <tr>
                                            <th>ID</th>
                                            <th>{{ 'label_description'|trans }}</th>
                                            <th>{{ 'label_property'|trans }}</th>
                                            <th>{{ 'label_type'|trans }}</th>
                                            <th>{{ 'label_status'|trans }}</th>
                                            <th>{{ 'label_issued'|trans }}</th>
                                            <th>{{ 'label_paid'|trans }}</th>
                                            <th>&nbsp;</th>

                                        </tr>
                                    </tfoot>
                                    <thead>
                                    <tr>
                                        {# sorting of properties based on query components #}
                                        <th>ID</th>
                                        <th>{{ 'label_description'|trans }}</th>
                                        <th>{{ 'label_property'|trans }}</th>
                                        <th>{{ 'label_type'|trans }}</th>
                                        <th>{{ 'label_status'|trans }}</th>
                                        <th>{{ 'label_issued'|trans }}</th>
                                        <th>{{ 'label_paid'|trans }}</th>
                                        <th>{{ 'label_actions'|trans }}</th>
                                    </tr>

                                    </thead>
                                    <tbody></tbody>

                                </table>
                                {# display navigation #}

                            </div>
                            <!-- end widget content -->

                        </div>



                        <div id="tabs-booking">

                            <!-- widget content -->
                            <div class="widget-body no-padding">

                                <div class="widget-body-toolbar">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>{{ 'label_requested'|trans }} ({{ 'label_dates'|trans }})</label>
                                        </div>
                                        <div class="clearfix"></div>
                                        <div class="input-daterange">
                                            <div class="col-md-4">
                                                <input type="text" name="start_date" id="start_date" class="form-control myDate" />
                                            </div>
                                            <div class="col-md-4">
                                                <input type="text" name="end_date" id="end_date" class="form-control myDate" />
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <br/>

                                <table  style="width: 100%;" id="booking_table" class="table table-striped table-hover fulltable">
                                    <tfoot class="dt_tfoot">
                                    <tr>
                                        <th>ID</th>
                                        <th>{{ 'label_common_area'|trans }}</th>
                                        <th>{{ 'label_property'|trans }}</th>
                                        <th>{{ 'label_login_user'|trans }}</th>
                                        <th>{{ 'label_status'|trans }}</th>
                                        <th>{{ 'label_event_date'|trans }}</th>
                                        <th>{{ 'label_requested'|trans }}</th>
                                        <th>{{ 'label_approved'|trans }}</th>
                                        {#<th>{{ 'label_complex'|trans }}</th>#}
                                        {#
                                        <th>{{ 'label_hour_from'|trans }}</th>
                                        <th>{{ 'label_hour_to'|trans }}</th>

                                        #}
                                        <th></th>
                                    </tr>
                                    </tfoot>
                                    <thead>
                                    <tr>
                                        {# sorting of properties based on query components #}
                                        <th>ID</th>
                                        <th>{{ 'label_common_area'|trans }}</th>
                                        <th>{{ 'label_property'|trans }}</th>
                                        <th>{{ 'label_login_user'|trans }}</th>
                                        <th>{{ 'label_status'|trans }}</th>
                                        <th>{{ 'label_event_date'|trans }}</th>
                                        <th>{{ 'label_requested'|trans }}</th>
                                        <th>{{ 'label_approved'|trans }}</th>
                                        <th>{{ 'label_actions'|trans }}</th>
                                    </tr>

                                    </thead>
                                    <tbody></tbody>

                                </table>
                                {# display navigation #}

                            </div>
                            <!-- end widget content -->                            
                        </div>
                        <div id="tabs-log">
                            <br/>

                            <table id="log_table" class="table table-striped  table-hover fulltable">
                                <thead>
                                    <tr>
                                        <th>{{ 'label_date'|trans }}</th>
                                        <th>{{ 'label_description'|trans }}</th>
                                        <th>{{ 'label_user'|trans }}</th>
                                        <th>{{ 'label_status'|trans }}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% if entity.complex.geoState.timezoneName is not null %}
                                    {% set timezone =  entity.complex.geoState.timezoneName %}
                                {% else %}
                                    {% set timezone = 'America/New_York' %}
                                {% endif %}

                                {% for key, l in log %}

                                    <tr>
                                        <td>{{ l.date|date("m/d/Y H:i:s", timezone )}}</td>
                                        <td>{{ l.description }}</td>
                                        <td>{{ l.user }}</td>
                                        <td>{{ l.status|trans }}</td>

                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>



                        </div>

                    </div>

                </div>
            </div>

        </div>


    {#--- TICKETS ---#}
    <script type="text/javascript">


        $( function() {
            $( "#tabs" ).tabs();
        } );


        $(document).ready(function(){


            var ticketsTable;


            function fetchTickets(){

                ticketsTable  = $('#ticket_table').DataTable({
                    "columnDefs": [

                        // These are the column name variables that will be sent to the server
                        { "name": "id",   "targets": 0 },
                        { "name": "title",   "targets": 1 },
                        { "name": "type",   "targets": 2 },
                        { "name": "category",   "targets": 3 },
                        { "name": "status",   "targets": 4 },
                        { "name": "elapsed",   "targets": 5 },
                        { "name": "actions",  "targets": 6 },

                    ],
                    // Server-side parameters
                    "processing": true,
                    "serverSide": true,
                    // Ajax call
                    "ajax": {
                        "url": "{{ path('property_ticket_list_datatables', {property: entity.id}) }}",
                        "type": "POST",
                        //dataType: "html"
                    },
                    // Classic DataTables parameters
                    "paging" : true,
                    "info" : true,
                    "searching": true,
                    "pageLength": 10,
                    "order": [[0, 'desc']],
                    {% if myLocale == 'es' %}
                    "language": {
                        "url": "{{ asset('bundles/pizotearkadmin/js/plugin/datatables/dataTables.spanish.lang') }}"
                    }
                    {% else %}
                    "language": {
                        "infoFiltered": ""
                    }
                    {% endif %}



                });

            }

            //### TICKETS ###
            // Add a text input to each footer cell
            var pos = 1;
            $('#ticket_table tfoot th').each( function () {
                var title = $(this).text();
                if(pos == 1 || pos == 2 || pos == 4 ){//columna Actions
                    $(this).html( "<input id='ticket_input" + pos + "' type='text' class='form-control' style='font-family:Arial, FontAwesome; width:50%'/>" );
                }
                pos ++;
            });


            fetchTickets();

            // Apply the search
            pos = 1;
            ticketsTable.columns().every( function () {
                var that = this;

                $("#ticket_input"+pos).on( 'keyup change', function () {
                    if ( that.search() !== this.value )
                    {
                        that.search( this.value ).draw();
                    }
                });
                pos++;
            });


        });

    </script>

    {#--- BOOKING ---#}
    <script type="text/javascript">


        $(document).ready(function(){


            var tableBooking;

            function fetchData(){

                tableBooking  = $('#booking_table').DataTable({
                    "columnDefs": [

                        // These are the column name variables that will be sent to the server
                        { "name": "id",   "targets": 0 },
                        { "name": "commonArea",  "targets": 1 },
                        { "name": "property",   "targets": 2 },
                        { "name": "user",  "targets": 3 },
                        { "name": "status",  "targets": 4 },
                        { "name": "eventDate",  "targets": 5 },
                        { "name": "requested",  "targets": 6 },
                        { "name": "approved",  "targets": 7 },
                        { "name": "actions",  "targets": 8 }


                    ],
                    // Server-side parameters
                    "processing": true,
                    "serverSide": true,
                    // Ajax call
                    "ajax": {
                        "url": "{{ path('property_booking_list_datatables', {property: entity.id}) }}",
                        "type": "POST",
                        data   : function( d ) {
                            d.start_date= $('#start_date').val();
                            d.end_date= $('#end_date').val();

                        },
                        //"dataSrc": ""
                        //data: {start_date:$('#start_date').val(), end_date:$('#end_date').val()},
                    },
                    // Classic DataTables parameters
                    "paging" : true,
                    "info" : true,
                    "searching": true,
                    "pageLength": 10,
                    "order": [[6, 'asc']],/*EVENT DATE*/
                    {% if myLocale == 'es' %}
                    "language": {
                        "url": "{{ asset('bundles/pizotearkadmin/js/plugin/datatables/dataTables.spanish.lang') }}"
                    }
                    {% else %}
                    "language": {
                        "infoFiltered": ""
                    }
                    {% endif %}

                });

            }

            // Add a text input to each footer cell
            var pos = 1;
            $('#booking_table tfoot th').each( function () {
                var title = $(this).text();
                if( pos != 9){//columna fecha y actions
                    $(this).html( "<input id='booking_input" + pos + "' type='text' class='form-control' style='font-family:Arial, FontAwesome; width:100%'/>" );
                }

                pos ++;
            });


            fetchData();

            // Apply the search
            pos = 1;
            tableBooking.columns().every( function () {
                var that = this;

                $("#booking_input"+pos).on( 'keyup change', function () {
                    if ( that.search() !== this.value )
                    {
                        that.search( this.value ).draw();
                    }
                });
                pos++;
            });

            //Apply DATES SEARCH
            /*
            $(".myDate").on( 'keyup change', function () {
                table.search( this.value ).draw();
            });
            */


            ///////SEARCH BETWEEN DATES
            $('.input-daterange').datepicker({
                todayBtn:'linked',
                format: "yyyy-mm-dd",
                autoclose: true
            });

            //fetch_data('no');


            $('.myDate').change(function(){
                var start_date = $('#start_date').val();
                var end_date = $('#end_date').val();
                if(start_date != '' && end_date !='')
                {
                    tableBooking.ajax.reload()

                }
                else
                {
                    alert("Both Date is Required");
                }
            });



        });

    </script>

    {#--- PAYMENTS ---#}
    <script type="text/javascript">


        $(document).ready(function(){



            var paymentsTable;


            function fetchData(){

                paymentsTable  = $('#payment_table').DataTable({
                    "columnDefs": [

                        // These are the column name variables that will be sent to the server
                        { "name": "id",   "targets": 0 },
                        { "name": "description",   "targets": 1 },
                        { "name": "property",   "targets": 2 },
                        { "name": "type",   "targets": 3 },
                        { "name": "status",  "targets": 4 },
                        { "name": "createdat",  "targets": 5 },
                        { "name": "paid",  "targets": 6 },
                        { "name": "actions",  "targets": 7 },

                    ],
                    // Server-side parameters
                    "processing": true,
                    "serverSide": true,
                    // Ajax call
                    "ajax": {
                        "url": "{{ path('property_payment_list_datatables', {property: entity.id})  }}",
                        "type": "POST",
                        //dataType: "html"
                    },
                    // Classic DataTables parameters
                    "paging" : true,
                    "info" : true,
                    "searching": true,
                    "pageLength": 10,
                    "order": [[0, 'desc']],
                    {% if myLocale == 'es' %}
                    "language": {
                        "url": "{{ asset('bundles/pizotearkadmin/js/plugin/datatables/dataTables.spanish.lang') }}"
                    }
                    {% else %}
                    "language": {
                        "infoFiltered": ""
                    }
                    {% endif %}


                });

            }

            // Add a text input to each footer cell
            var pos = 1;
            $('#payment_table tfoot th').each( function () {
                var title = $(this).text();
                if(pos != 8){//columna Actions
                    $(this).html( "<input id='payment_input" + pos + "' type='text' class='form-control' style='font-family:Arial, FontAwesome; width:100%'/>" );
                }

                pos ++;
            });


            fetchData();

            // Apply the search
            pos = 1;
            paymentsTable.columns().every( function () {
                var that = this;

                $("#payment_input"+pos).on( 'keyup change', function () {
                    if ( that.search() !== this.value )
                    {
                        that.search( this.value ).draw();
                    }
                });
                pos++;
            });

            $("#payment_input5").remove();
        });



        {#--- LOG ---#}
        $('#log_table').DataTable( {
            /* Disable initial sort */
            "aaSorting": [],

            {% if myLocale == 'es' %}
            "language": {
                "url": "{{ asset('bundles/pizotearkadmin/js/plugin/datatables/dataTables.spanish.lang') }}"
            }
            {% else %}
            "language": {
                "infoFiltered": ""
            }
            {% endif %}

        } );

        $("#log_table_filter").show();

    </script>



{% endblock %}

{% block extrascripts %}



{% endblock %}