<link href="{{ asset('bundles/pizotearkadmin/js/flagstrap-master/dist/css/flags.css')  }}" rel="stylesheet" />
<script src="{{ asset('bundles/pizotearkadmin/js/flagstrap-master/dist/js/jquery.flagstrap.js') }}"></script>

<div class="header">
	<div class="container">
		<div class="row">
			<div class="col-md-10">
				<h3 class="header-title">{{ 'label_register_create_company'|trans }}</h3>
			</div>
			<div class="col-md-2 text-right">
				<h3 class="header-title-step">{{ 'label_step'|trans }} 1/2</h3>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<blockquote>
					<div class="col-md-11">
						<p> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla vulputate quam ut risus ullamcorper convallis. Morbi pellentesque congue elit malesuada pharetra. Suspendisse iaculis interdum elit, et porta ex tempus eget. Ut nec diam dictum, cursus metus euismod, aliquet ante. Quisque a lacus dapibus, semper ante ac, mollis nibh. Integer gravida tellus nec commodo facilisis. Ut ornare ex a dui elementum, quis mollis ante tristique. Sed hendrerit congue neque, non ornare enim. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.  </p>
					</div>
					<div class="col-md-1 text-right">
						<i style="font-size:80px;" class="fa fa-question-circle" aria-hidden="true"></i>
					</div>
				</blockquote>
			</div>
		</div>

	</div>

</div>

<div class="form-inputs-g">

	{{ form_start(form) }}
	{{ form_errors(form) }}

	{#THE USER WHO CREATES THE BUSINESS #}
	{% if new is defined %}
		<input type="hidden" name="userID" value="{{ userID }}">
	{% endif %}

	<div id="checkEmailAlert" class="alert alert-warning" role="alert" style="display: none" >
		{{ 'label_business_check_email'|trans }}
	</div>
	<div id="checkPhoneAlert" class="alert alert-warning" role="alert" style="display: none" >
		{{ 'label_business_check_phone'|trans }}
	</div>

	<div class="row">
		<div class="col-md-4">
			<div class="form-group ">
				{{ form_label(form.name) }}
				{{ form_errors(form.name) }}
				{{ form_widget(form.name, { 'attr': {'class' : 'form-control' } }
				) }}
			</div>
		</div>
		<div class="form-group col-md-4">
			<div class="form-group ">
				{{ form_label(form.phoneNumber) }}
				{{ form_errors(form.phoneNumber) }}
				{{ form_widget(form.phoneNumber, { 'attr': {'class' : 'form-control' } }
				) }}

			</div>
		</div>
		<div class="form-group col-md-4">
			<div class="form-group ">
				{{ form_label(form.email) }}
				{{ form_errors(form.email) }}
				{{ form_widget(form.email, { 'attr': {'class' : 'form-control' } }
				) }}

			</div>
		</div>


	</div>
	<div class="row">

		<div class="col-md-2">
			<div class="form-group">
				<label for="name">{{ 'label_country'|trans }}</label>
				{% if edit is defined %}
					<div id="" class="flagstrap" data-input-name="business_country" data-selected-country="{{ entity.geoState.geoCountry.shortName }}"></div>
				{% else %}
					<div id="" class="flagstrap" data-input-name="business_country" data-selected-country="US"></div>
				{% endif %}
			</div>
		</div>
		<div class="col-md-2">
			<div class="form-group ">

				{{ form_label(form.geoState) }}
				{{ form_errors(form.geoState) }}
				<div id="divGeoState">
					{{ form_widget(form.geoState, { 'attr': {'class' : 'form-control classic' } }) }}
				</div>

			</div>
		</div>
		<div class="col-md-4">
			{{ form_label(form.zipCode) }}
			{{ form_errors(form.zipCode) }}
			{{ form_widget(form.zipCode, { 'attr': {'class' : 'form-control' } }
			) }}
		</div>
		<div class="form-group col-md-4">
			<div class="form-group ">
				{{ form_label(form.address) }}
				{{ form_errors(form.address) }}
				{{ form_widget(form.address, { 'attr': {'class' : 'form-control' } }
				) }}
			</div>
		</div>


	</div>
	<div class="clearfix"></div>


	<h2 class="header-title-step">{{ 'label_billing_information'|trans }}</h2>
	<div class="clearfix"></div>

	<div class="checkbox">
		<label>
			<input type="checkbox"  class="" id="copyBillingInfo" onclick=""><a target="" href="#">{{ 'label_billing_copy'|trans }}</a>
		</label>
	</div>



	<div class="clearfix"></div>

	<div class="row">
		<div id="billing_info">
			<div class="col-md-2">

				<div class="form-group">
					<label for="name">{{ 'label_country'|trans }}</label>
					<div id="divBillingCountry">

						{% if edit is defined %}
							<div id="myFlagstrap"  class="flagstrap" data-input-name="business_billing_country" data-selected-country="{{ entity.billingGeoState.geoCountry.shortName }}"></div>

						{% else %}
							<div id="myFlagstrap"  class="flagstrap" data-input-name="business_billing_country" data-selected-country="US"></div>
						{% endif %}

					</div>
				</div>

			</div>

			<div class="form-group col-md-2">
				<div class="form-group ">
					{{ form_label(form.billingGeoState) }}
					{{ form_errors(form.billingGeoState) }}
					<div id="divBillingGeoState">
						{{ form_widget(form.billingGeoState, { 'attr': {'class' : 'form-control' } }) }}
					</div>
				</div>

			</div>
			<div class="form-group col-md-4">
				<div class="form-group ">
				{{ form_label(form.billingZipCode) }}
				{{ form_errors(form.billingZipCode) }}
				{{ form_widget(form.billingZipCode, { 'attr': {'class' : 'form-control' } }
				) }}
				</div>
			</div>
			<div class="form-group col-md-4">
				<div class="form-group ">
				{{ form_label(form.billingAddress) }}
				{{ form_errors(form.billingAddress) }}
				{{ form_widget(form.billingAddress, { 'attr': {'class' : 'form-control' } }
				) }}
				</div>
			</div>


		</div>
	</div>


	<div class="clearfix"></div>

	<div class="row">

		<div class="form-group col-md-4">
			{{ form_label(form.taxName) }}
			{{ form_errors(form.taxName) }}
			{{ form_widget(form.taxName, { 'attr': {'class' : 'form-control' } }
			) }}
		</div>
		<div class="form-group col-md-4">
			{{ form_label(form.taxIdentifier) }}
			{{ form_errors(form.taxIdentifier) }}
			{{ form_widget(form.taxIdentifier, { 'attr': {'class' : 'form-control' } }
			) }}
		</div>
	</div>


	<div class="hide">
		{{ form_rest(form) }}
	</div>

	<div class="row">

		<div class="form-group col-md-4">
			<button type="submit" class="btn btn-primary">{{ 'label_register_create_company_2'|trans }}</button>
		</div>
	</div>

	<!--</form>-->
	{{ form_end(form) }}

</div>





</div>

<script type="text/javascript" language="Javascript">

	$( document ).ready(function() {



		$('.flagstrap').flagStrap({

			placeholder: {
				value: "",
				text: ""
			},
			countries: {
				{% for country in countries %}
				"{{ country.shortName }}": "{{ country.name }} +{{ country.code }}",
				{% endfor %}
			},

		});


		$("[name='business']").validate({
			success: function(error){
				$("#pizote_spinner").show();
				return true;
			},

		});

		$("#business_zipCode").rules("add", {required:true, minlength: 5, digits:true});
		$("#business_billingZipCode").rules("add", {required:true, minlength: 4, digits:true});

		$("#business_phoneNumber").rules("add", {required:true, minlength: 8, digits:true});
		$("#business_email").rules("add", {required:true, email:true});

		//$("#business_taxIdentifier").


		$('[name="business"]').on("submit", function(){
			//Code: Action (like ajax...)
			if($("[name='business']").valid()){

				checkEmail = checkEmail();
				if(checkEmail.result == 0){
					return false;
				}

				checkPhone = checkPhone();
				if(checkPhone.result == 0){
					return false;
				}

				$('#pizote_spinner').show();
				return true;

			}
			else{
				return false;
			}

		});

		$("#copyBillingInfo").change(function(){

			//alert($('[name="business_country"]').val());
			$('#pizote_spinner').show();

			if(this.checked){
				$("#business_billingAddress").val($("#business_address").val());
				$("#business_billingZipCode").val($("#business_zipCode").val());
				$("#divBillingCountry").html('<div id="myFlagstrap" class="flagstrap" data-input-name="business_billing_country" data-selected-country="'+$('[name="business_country"]').val()+'"></div>');

				$('#myFlagstrap').flagStrap({

					placeholder: {
						value: "",
						text: ""
					},
					countries: {
						{% for country in countries %}
						"{{ country.shortName }}": "{{ country.name }} +{{ country.code }}",
						{% endfor %}
					},

				});

				changeState(1);
				$("#business_billingGeoState").val($("#business_geoState").val());


			}
			else{
				$("#business_billingAddress").val("");
				$("#business_billingZipCode").val("");
				$("#divBillingCountry").html('<div id="myFlagstrap" class="flagstrap" data-input-name="business_billing_country" data-selected-country="US"></div>');

				$('#myFlagstrap').flagStrap({

					placeholder: {
						value: "",
						text: ""
					},
					countries: {
						{% for country in countries %}
						"{{ country.shortName }}": "{{ country.name }} +{{ country.code }}",
						{% endfor %}
					},

				});

				changeState(1);

			}

			$('#pizote_spinner').hide();

		});

		$('#business_email').change(function(){
			checkEmail();
		});

		$('#business_phoneNumber').change(function(){
			checkPhone();
		});





		$('[name="business_country"]').change(function(){
			changeState(0);
		});

		$('[name="business_billing_country"]').change(function(){
			changeState(1);
		});

		changeState(0);
		changeState(1);

		//$('#pizote_spinner').show();

	});


	function changeState(billing){


		if(billing){//==1 if it is a billing call
			myCountry = $('[name="business_billing_country"]').val();
			{% if edit is defined %}
				myState = {{ entity.billingGeoState.id }};
			{% endif %}

		}
		else{
			myCountry = $('[name="business_country"]').val();
			{% if edit is defined %}
				myState = {{ entity.geoState.id }};
			{% endif %}
		}


		$.ajax({
			type:"POST",
			dataType:"html",
			async:false,
			url:"{{ path('backend_admin_business_update_state') }}",
			//data:"countryShort="+myCountry,
			{% if edit is defined %}
				data: {countryShort: myCountry, billing: billing, selectedState: myState},
			{% else %}
				data: {countryShort: myCountry, billing: billing},
			{% endif %}
			success:function(data){
				if(billing){
					$("#divBillingGeoState").html(data);
				}
				else{
					$("#divGeoState").html(data);
				}

			}
		});

	}


	function checkEmail(){

		$.ajax({
			type:"POST",
			dataType:"json",
			url:"{{ path('backend_admin_business_check_email') }}",
			data:"email="+$( "#business_email" ).val(),
			success:function(data){
				//console.log(data);
				if(data.result == 0){
					$("#checkEmailAlert").show();
					$( "#business_email" ).val("");
					$( "#business_email" ).focus();
				}

				if(data.result == 1){
					$("#checkEmailAlert").hide();
				}
			}
		});

	}

	function checkPhone(){

		$.ajax({
			type:"POST",
			dataType:"json",
			url:"{{ path('backend_admin_business_check_phone') }}",
			data:"phone="+$( "#business_phoneNumber" ).val(),
			success:function(data){
				//console.log(data);
				if(data.result == 0){
					$("#checkPhoneAlert").show();
					$( "#business_phoneNumber" ).val("");
					$( "#business_phoneNumber" ).focus();
				}

				if(data.result == 1){
					$("#checkPhoneAlert").hide();
				}
			}
		});


	}



</script>