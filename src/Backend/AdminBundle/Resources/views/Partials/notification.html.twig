{#
{{ notifications_assets() }}
<script>
    /**
     * After calling notifications_assets() "pusher" is now available
     * and you can use it this way
     */

        // select the channel you want to listen to
    var channel = pusher.subscribe("notifications");// notifications channel
    channel.bind("my-event", function(data) {
        console.log('from notifications channel', data);
    });

    var channel = pusher.subscribe("messages");// messages channel
    channel.bind("my-event", function(data) {
        console.log('from messages channel', data);
        alert("nueva notificacion");
    });
</script>

#}



<li class="dropdown notification">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
        <span class="label label-danger arrowed arrow-left-in pull-right" id="notificationCount">0</span>
        <i class="fa fa-bell"></i>
    </a>
    <ul class="dropdown-menu pull-right" id="">

        <li class="open-section">
            <a href="{{ path('notification_mark_all_read') }}">{{ 'label_mark_all_read'|trans }}</a>
        </li>
    </ul>
    <ul class="dropdown-menu pull-right" id="notificationList">

        {#

        <li class="open-section">
            <a href="#">View All Notifications</a>
        </li>
        <li>
            <a href="#">
                <i class="fa fa-bell pull-left"></i>
                <span class="time">13 min. ago</span>
                <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy et dolore.</p>
            </a>
        </li>


        #}


    </ul>
</li>

<script type="text/javascript">

        var reservationPath = "{{ path('backend_admin_common_area_reservation_notification_read') }}";

        var now = new Date();

		var ajax_call = function() {
            $.ajax({
                type:"POST",
                dataType:"json",
                url:"{{ path('backend_admin_common_area_reservation_notification') }}",
                //data:
                success:function(data){
                    //console.log(data.result);
                    if(parseInt(data.result) != 0){

                        var notificationCount = 0;
                        $("#notificationList").html("");

                        myResult = data.result;
                        for(notification in myResult){

                            //console.log(myResult[notification]);
                            createdAt = new Date(myResult[notification].created_at);
                            var diff = Math.abs(now.getTime() - createdAt.getTime()) / 3600000;
                            diff = Math.round(diff);
                            if (diff <= 24) {
                                /* do something */
                                {% if app.request.getLocale() == "es" %}
                                    hoursAgo = "hace "+diff+ " horas";
                                {% else %}
                                    hoursAgo = diff+" hours ago";
                                {% endif %}

                            }
                            else{
                                {% if app.request.getLocale() == "es" %}
                                hoursAgo = "hace mÃ¡s de 24hrs";
                                {% else %}
                                hoursAgo = "more than 24hrs ago";
                                {% endif %}

                            }
                            //console.log(diff);

                            $("#notificationList").append('        <li>' +
                                '            <a href="'+reservationPath+'?notificationID='+notification+'" href="#">' +
                                '                <i class="fa fa-bell pull-left"></i>' +
                                '                <span class="time">'+hoursAgo+'</span>' +
                                '                <p>'+myResult[notification].description+'</p>' +
                                '            </a>' +
                                '        </li>');

                            notificationCount++;
                        }

                    }

                    $("#notificationCount").html(notificationCount);



                }
            });
  		
		};


		var interval = 30000;//1000 = 1 second

        setTimeout(ajax_call, 1000);//one time
		setInterval(ajax_call, interval);

	
</script>	

