{% extends 'BackendAdminBundle::layout.html.twig' %}

{% block breadcrumb %}
    {{ parent() }}
    <li> <a href="{{ path('backend_admin_poll_index') }}"></a>{{ 'label_menu.poll'|trans }} </li>
{% endblock %}

{% block title %}
    {{ 'label_poll'|trans }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/pizotearkadmin/js/plugin/Buttons-1.2.2/css/buttons.dataTables.css') }}">
    <link rel="stylesheet" type="text/css" href=""{{ asset('bundles/pizotearkadmin/js/plugin/FixedHeader-3.1.4/css/fixedHeader.dataTables.css') }}">

    <script src="{{ asset('bundles/pizotearkadmin/js/plugin/Buttons-1.2.2/js/dataTables.buttons.js') }}"></script>
    <script src="{{ asset('bundles/pizotearkadmin/js/plugin/Buttons-1.2.2/js/buttons.print.js') }}"></script>
    <script src="{{ asset('bundles/pizotearkadmin/js/plugin/FixedColumns-3.2.5/js/dataTables.fixedColumns.js') }}"></script>


{% endblock %}


{% block body -%}
    {{ parent() }}

    <div class="header">
        <div class="container">
            <div class="row">
            </div>
            <br/>
            <div class="row">
                <div class="col-md-6">
                    <h3 class="header-title">{{ 'label_poll'|trans }} #{{ poll }} - {{ 'label_answers'|trans }} </h3>
                </div>


            </div>
            <div class="row">
                <div class="col-md-12">
                    <blockquote>
                        <div class="col-md-11">
                            <p> {{ 'label_ticket_system_advice'|trans }}  </p>
                        </div>
                        <div class="col-md-1 text-right">
                            <i style="font-size:80px;" class="fa fa-question-circle" aria-hidden="true"></i>
                        </div>
                    </blockquote>
                </div>
            </div>

        </div>
    </div>

    <div class="container">
        <div class="jarviswidget jarviswidget-color-darken" id="wid-id-0" data-widget-editbutton="false">

            <!-- widget div-->
            <div>

                <!-- widget edit box -->
                <div class="jarviswidget-editbox">
                    <!-- This area used as dropdown edit box -->

                </div>

                <!-- end widget edit box -->

                <!-- widget content -->
                <div class="widget-body no-padding">

                    <div class="widget-body-toolbar">

                    </div>

                    <table id="dt_table" class="table table-striped table-hover">
                        <tfoot class="dt_tfoot">
                        <tr>
                            <th class="pizoteTableID">{{ 'label_user_id'|trans }}</th>
                            {#<th>{{ 'label_complex'|trans }}</th>#}
                            <th>{{ 'label_user'|trans }}</th>
                            <th class="pizoteTableID">{{ 'label_question_id'|trans }}</th>
                            <th>{{ 'label_question'|trans }}</th>
                            <th class="pizoteTableID">{{ 'label_anwser_id'|trans }}</th>
                            <th>{{ 'label_answer'|trans }}</th>

                        </tr>
                        </tfoot>
                        <thead>
                            <tr>
                                <th class="pizoteTableID">{{ 'label_user_id'|trans }}</th>
                                {#<th>{{ 'label_complex'|trans }}</th>#}
                                <th>{{ 'label_user'|trans }}</th>
                                <th class="pizoteTableID">{{ 'label_question_id'|trans }}</th>
                                <th>{{ 'label_question'|trans }}</th>
                                <th class="pizoteTableID">{{ 'label_anwser_id'|trans }}</th>
                                <th>{{ 'label_answer'|trans }}</th>
                            </tr>

                        </thead>
                        <tbody></tbody>

                    </table>
                    {# display navigation #}

                </div>
                <!-- end widget content -->


            </div>
            <!-- end widget div -->
        </div>
    </div>



    <script type="text/javascript">



        $(document).ready(function() {

            /* For Export Buttons available inside jquery-datatable "server side processing" - Start
            - due to "server side processing" jquery datatble doesn't support all data to be exported
            - below function makes the datatable to export all records when "server side processing" is on */

            function newexportaction(e, dt, button, config) {
                var self = this;
                var oldStart = dt.settings()[0]._iDisplayStart;
                dt.one('preXhr', function (e, s, data) {
                    // Just this once, load all data from the server...
                    data.start = 0;
                    data.length = 2147483647;
                    dt.one('preDraw', function (e, settings) {
                        // Call the original action function
                        if (button[0].className.indexOf('buttons-copy') >= 0) {
                            $.fn.dataTable.ext.buttons.copyHtml5.action.call(self, e, dt, button, config);
                        } else if (button[0].className.indexOf('buttons-excel') >= 0) {
                            $.fn.dataTable.ext.buttons.excelHtml5.available(dt, config) ?
                                $.fn.dataTable.ext.buttons.excelHtml5.action.call(self, e, dt, button, config) :
                                $.fn.dataTable.ext.buttons.excelFlash.action.call(self, e, dt, button, config);
                        } else if (button[0].className.indexOf('buttons-csv') >= 0) {
                            $.fn.dataTable.ext.buttons.csvHtml5.available(dt, config) ?
                                $.fn.dataTable.ext.buttons.csvHtml5.action.call(self, e, dt, button, config) :
                                $.fn.dataTable.ext.buttons.csvFlash.action.call(self, e, dt, button, config);
                        } else if (button[0].className.indexOf('buttons-pdf') >= 0) {
                            $.fn.dataTable.ext.buttons.pdfHtml5.available(dt, config) ?
                                $.fn.dataTable.ext.buttons.pdfHtml5.action.call(self, e, dt, button, config) :
                                $.fn.dataTable.ext.buttons.pdfFlash.action.call(self, e, dt, button, config);
                        } else if (button[0].className.indexOf('buttons-print') >= 0) {
                            $.fn.dataTable.ext.buttons.print.action(e, dt, button, config);
                        }
                        dt.one('preXhr', function (e, s, data) {
                            // DataTables thinks the first item displayed is index 0, but we're not drawing that.
                            // Set the property to what it was before exporting.
                            settings._iDisplayStart = oldStart;
                            data.start = oldStart;
                        });
                        // Reload the grid with the original page. Otherwise, API functions like table.cell(this) don't work properly.
                        setTimeout(dt.ajax.reload, 0);
                        // Prevent rendering of the full data to the DOM
                        return false;
                    });
                });
                // Requery the server with the new one-time export settings
                dt.ajax.reload();
            };
            //For Export Buttons available inside jquery-datatable "server side processing"


            var table;
        {% set myLocale = app.request.getLocale() %};

        function fetchData(){

            table  = $('#dt_table').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    //{extend: 'print', text: 'Imprimir', message: ''},
                    {	extend: 'excel',
                        text: '{{ "label_export_excel"|trans }}',
                        message: '',
                        action: newexportaction

                    },


                ],

                "columnDefs": [

                    // These are the column name variables that will be sent to the server
                    { "name": "user_id",   "targets": 0 },
                    { "name": "user",   "targets": 1 },
                    { "name": "question_id",   "targets": 2 },
                    { "name": "question",   "targets": 3 },
                    { "name": "answer_id",   "targets": 4 },
                    { "name": "answer",   "targets": 5 },

                ],
                // Server-side parameters
                "processing": true,
                "serverSide": true,
                // Ajax call
                "ajax": {
                    "url": "{{ path('backend_admin_poll_view_answers_list_datatables', {'poll': poll}) }}",
                    "type": "POST",
                    //dataType: "html"
                },
                // Classic DataTables parameters
                "paging" : true,
                "info" : true,
                "searching": true,
                "pageLength": 10,
                "order": [[2, 'asc']],
                {% if myLocale == 'es' %}
                "language": {
                    "url": "{{ asset('bundles/pizotearkadmin/js/plugin/datatables/dataTables.spanish.lang') }}"
                }
                {% else %}
                "language": {
                    "infoFiltered": ""
                }
                {% endif %}



            });

        }



            // Add a text input to each footer cell
            var pos = 1;
            $('#dt_table tfoot th').each( function () {
                var title = $(this).text();

                $(this).html( "<input id='input" + pos + "' type='text' class='form-control' style='font-family:Arial, FontAwesome; width:100%'/>" );


                pos ++;
            });


            fetchData();

            // Apply the search
            pos = 1;
            table.columns().every( function () {
                var that = this;

                $("#input"+pos).on( 'keyup change', function () {
                    if ( that.search() !== this.value )
                    {
                        that.search( this.value ).draw();
                    }
                });
                pos++;
            });

            $("#input6").remove();
        });

    </script>




{% endblock %}


{% block extrascripts %}


    $(document).on('click', '.btn-delete', function(e){
    e.preventDefault();

    var url = $(this).attr('href');
    var c = confirm("{{ 'label_are_you_sure'|trans }}");

    if(c){
    $('#spinner').show();
    window.location = url;
    }else{
    return false;
    }


    });

{% endblock %}